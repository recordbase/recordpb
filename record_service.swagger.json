{
  "swagger": "2.0",
  "info": {
    "title": "RecordService",
    "version": "1.0",
    "contact": {
      "name": "RecordService",
      "url": "https://github.com/codeallergy/record",
      "email": "zander@schwid.com"
    }
  },
  "tags": [
    {
      "name": "RecordService"
    }
  ],
  "schemes": [
    "http",
    "https"
  ],
  "consumes": [
    "application/json",
    "application/octet-stream"
  ],
  "produces": [
    "application/json",
    "application/octet-stream"
  ],
  "paths": {
    "/api/v1/counts": {
      "put": {
        "summary": "Gets attributes counts",
        "operationId": "RecordService_GetCounts",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseCounts"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseTenantRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/keys/add": {
      "put": {
        "summary": "Allocate primary key range",
        "operationId": "RecordService_AddKeyRange",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object",
              "properties": {}
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseKeyRange"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/keys/capacity": {
      "put": {
        "summary": "Gets primary keys capacity",
        "operationId": "RecordService_GetKeyCapacity",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseKeyCapacity"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseTenantRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/create": {
      "put": {
        "summary": "Create record with new primary_key",
        "operationId": "RecordService_Create",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseCreateResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseCreateRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/delete": {
      "put": {
        "summary": "Delete record",
        "operationId": "RecordService_Delete",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object",
              "properties": {}
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseDeleteRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/get": {
      "put": {
        "summary": "Get record with all attributes",
        "operationId": "RecordService_Get",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseRecordEntry"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseGetRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/lookup": {
      "put": {
        "summary": "Quick record lookup request",
        "operationId": "RecordService_Lookup",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseRecordEntry"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseLookupRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/map/get": {
      "put": {
        "summary": "Get map value associated with the record",
        "operationId": "RecordService_MapGet",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseMapEntry"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseMapGetRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/map/put": {
      "put": {
        "summary": "Put map value associated with the record. Returns old value.",
        "operationId": "RecordService_MapPut",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseMapValue"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseMapPutRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/map/range": {
      "put": {
        "summary": "Scan all map key-value pairs",
        "operationId": "RecordService_MapRange",
        "responses": {
          "200": {
            "description": "A successful response.(streaming responses)",
            "schema": {
              "type": "object",
              "properties": {
                "result": {
                  "$ref": "#/definitions/recordbaseMapEntry"
                },
                "error": {
                  "$ref": "#/definitions/rpcStatus"
                }
              },
              "title": "Stream result of recordbaseMapEntry"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseMapRangeRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/map/remove": {
      "put": {
        "summary": "Remove map value associated with the record. Returns old value.",
        "operationId": "RecordService_MapRemove",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/recordbaseMapValue"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseMapRemoveRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/scan": {
      "put": {
        "summary": "Scan records",
        "operationId": "RecordService_Scan",
        "responses": {
          "200": {
            "description": "A successful response.(streaming responses)",
            "schema": {
              "type": "object",
              "properties": {
                "result": {
                  "$ref": "#/definitions/recordbaseRecordEntry"
                },
                "error": {
                  "$ref": "#/definitions/rpcStatus"
                }
              },
              "title": "Stream result of recordbaseRecordEntry"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseScanRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/search": {
      "put": {
        "summary": "Search records by indexed attributes",
        "operationId": "RecordService_Search",
        "responses": {
          "200": {
            "description": "A successful response.(streaming responses)",
            "schema": {
              "type": "object",
              "properties": {
                "result": {
                  "$ref": "#/definitions/recordbaseRecordEntry"
                },
                "error": {
                  "$ref": "#/definitions/rpcStatus"
                }
              },
              "title": "Stream result of recordbaseRecordEntry"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseSearchRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    },
    "/api/v1/records/update": {
      "put": {
        "summary": "Update record attributes",
        "operationId": "RecordService_Update",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object",
              "properties": {}
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/recordbaseUpdateRequest"
            }
          }
        ],
        "tags": [
          "RecordService"
        ]
      }
    }
  },
  "definitions": {
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "recordbaseAttributeEntry": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      },
      "title": "all attributes are indexed in the form of 'name:value' -\u003e record, list\u003crecord\u003e"
    },
    "recordbaseColumnEntry": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "value": {
          "type": "string",
          "format": "byte"
        }
      },
      "title": "keys stored inside the record, values stored inside the record"
    },
    "recordbaseCountEntry": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "count": {
          "type": "string",
          "format": "int64"
        }
      }
    },
    "recordbaseCounts": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseCountEntry"
          }
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseCountEntry"
          }
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseCountEntry"
          }
        }
      }
    },
    "recordbaseCreateRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseAttributeEntry"
          }
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseColumnEntry"
          }
        },
        "files": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseFileEntry"
          }
        }
      }
    },
    "recordbaseCreateResponse": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        }
      }
    },
    "recordbaseDeleteRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        }
      }
    },
    "recordbaseFileEntry": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "data": {
          "type": "string",
          "format": "byte"
        },
        "size": {
          "type": "integer",
          "format": "int32"
        },
        "createdAt": {
          "type": "string",
          "format": "int64"
        }
      },
      "title": "keys stored inside the record, values stored outside of the record"
    },
    "recordbaseGetRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        },
        "fileContents": {
          "type": "boolean"
        }
      }
    },
    "recordbaseKeyCapacity": {
      "type": "object",
      "properties": {
        "pendingKeys": {
          "type": "string",
          "format": "int64"
        }
      }
    },
    "recordbaseKeyRange": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "firstKey": {
          "type": "string",
          "format": "int64"
        },
        "lastKey": {
          "type": "string",
          "format": "int64"
        }
      }
    },
    "recordbaseLookupRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "lookupType": {
          "$ref": "#/definitions/recordbaseLookupType"
        },
        "name": {
          "type": "string"
        },
        "key": {
          "type": "string"
        },
        "fileContents": {
          "type": "boolean"
        }
      }
    },
    "recordbaseLookupType": {
      "type": "string",
      "enum": [
        "UNKNOWN_LOOKUP",
        "BY_PRIMARY_KEY",
        "BY_ATTRIBUTE",
        "BY_TAG"
      ],
      "default": "UNKNOWN_LOOKUP"
    },
    "recordbaseMapEntry": {
      "type": "object",
      "properties": {
        "mapKey": {
          "type": "string"
        },
        "value": {
          "type": "string",
          "format": "byte"
        },
        "ttl": {
          "type": "integer",
          "format": "int32"
        }
      },
      "title": "keys stored outside of the record, values stored outside of the record"
    },
    "recordbaseMapGetRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        },
        "mapKey": {
          "type": "string"
        }
      }
    },
    "recordbaseMapPutRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        },
        "mapKey": {
          "type": "string"
        },
        "value": {
          "type": "string",
          "format": "byte"
        },
        "ttl": {
          "type": "integer",
          "format": "int32"
        }
      }
    },
    "recordbaseMapRangeRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "prefix": {
          "type": "string"
        },
        "offset": {
          "type": "integer",
          "format": "int32"
        },
        "limit": {
          "type": "integer",
          "format": "int32"
        }
      }
    },
    "recordbaseMapRemoveRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        },
        "mapKey": {
          "type": "string"
        }
      }
    },
    "recordbaseMapValue": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string",
          "format": "byte"
        },
        "updated": {
          "type": "boolean"
        }
      }
    },
    "recordbaseRecordEntry": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        },
        "version": {
          "type": "string",
          "format": "int64"
        },
        "createdAt": {
          "type": "string",
          "format": "int64"
        },
        "updatedAt": {
          "type": "string",
          "format": "int64"
        },
        "deletedAt": {
          "type": "string",
          "format": "int64"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseAttributeEntry"
          },
          "title": "all records are indexed by hash256(name:value)"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "title": "all records are indexed by tag"
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseColumnEntry"
          },
          "title": "values stored inside the record"
        },
        "files": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseFileEntry"
          },
          "title": "values stored outside of record"
        }
      },
      "title": "located in tenant:rec:primary_key"
    },
    "recordbaseScanRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "prefix": {
          "type": "string"
        },
        "offset": {
          "type": "integer",
          "format": "int32"
        },
        "limit": {
          "type": "integer",
          "format": "int32"
        }
      }
    },
    "recordbaseSearchRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "lookupType": {
          "$ref": "#/definitions/recordbaseLookupType"
        },
        "name": {
          "type": "string"
        },
        "key": {
          "type": "string"
        }
      }
    },
    "recordbaseTenantRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        }
      }
    },
    "recordbaseUpdateRequest": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "primaryKey": {
          "type": "string"
        },
        "updateType": {
          "$ref": "#/definitions/recordbaseUpdateType"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseAttributeEntry"
          }
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseColumnEntry"
          }
        },
        "files": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/recordbaseFileEntry"
          }
        }
      }
    },
    "recordbaseUpdateType": {
      "type": "string",
      "enum": [
        "UNKNOWN_TYPE",
        "MERGE",
        "REPLACE"
      ],
      "default": "UNKNOWN_TYPE"
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    }
  }
}
